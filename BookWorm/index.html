<!DOCTYPE html>
<html>
<head>
    <title>Test</title>
    <link rel="stylesheet" href="public/bower_components/bootstrap/dist/css/bootstrap.css"> 
	<meta charset="utf-8" />
</head>
<body>
    <!--libs-->
    <script src="scripts/jquery-3.1.0.min.js"></script>
    <script src="scripts/libs/rspv.min.js"></script>
    <script src="scripts/app/httpRequester.js"></script>
    <script src="public/bower_components/sammy/lib/sammy.js"></script>
    <script src="public/bower_components/jquery/dist/jquery.js"></script>
    <script src="public/bower_components/handlebars/handlebars.js"></script>
    <script src="public/bower_components/SHA-1/sha1.js"></script>
    <script src="public/bower_components/crypto-js/crypto-js.js"></script>

    <script src="js/data.js"></script>
    <script src="js/templates.js"></script>

    <div id="root">
    <header>
      <div class="container">
        <div class="row">
          <h1 class="col-md-9">Bookworm</h1>
          <div id='login-controls' class="col-md-3">
            <a id="btn-go-to-login" class="btn btn-default"href="#/login">Login</a>
            <a id="btn-go-to-register" class="btn btn-default"href="#/register">Register</a>
            <button id="btn-logout" class="btn btn-default">Logout</button>
          </div>
        </div>
      </div>
      <nav class="navbar navbar-default">
        <ul class="nav navbar-nav">
          <li>
              <a href="#/books"><h3>Library</h3></a>
          </li>
        </ul>
      </nav>
    </header>
    <div id="content">

    </div>
  </div>

    <script>  
        var sammyApp = Sammy('#content', function(){
            var $content = $('#content');

            this.get("#/",function(){
          this.redirect("#/books");
      })

      this.get('#/login', function(context){
        if(data.users.current()){
          context.redirect("#/");
          return;
        }
     
            $content.html(`<h1>Login Form</h1>

            <input placeholder="Username" type="text" class="form-control" id="tb-user" style="width:300px" />
            <input placeholder="Password" type="text" class="form-control" id="tb-pass" style="width:300px"/>

            <div class="row">
            <button id="btn-login" class="btn btn-default col-sm-2 ">Login</button>
            </div>`);

            $("#btn-login").on("click",function(){
                var user={
                    username: $("#tb-user").val(),
                    password: $("#tb-pass").val()
                };
                data.users.login(user)
                .then(function(user){
                    context.redirect("#/");
                    document.location.reload(true);
                });
            });
            
        });
      

        this.get('#/register', function(context){
            if(data.users.current()){
            context.redirect("#/");
            return;
            }
     
            $content.html(`<h1>Register Form</h1>

            <input placeholder="Username" type="text" class="form-control" id="tb-user" style="width:300px" />
            <input placeholder="Password" type="text" class="form-control" id="tb-pass" style="width:300px"/>
            <input placeholder="Confirm Password" type="text" class="form-control" id="tb-conf-pass" style="width:300px"/>

            <div class="row">
            <button id="btn-register" class="btn btn-default col-sm-2 ">Register</button>
            </div>`);


           $("#btn-register").on("click",function(){
                var user={
                    username: $("#tb-user").val(),
                    password: $("#tb-pass").val(),
                    confirmPassword: $("#tb-conf-pass").val()
                };
                data.users.register(user)
                .then(function(user){
                    context.redirect("#/");
                    document.location.reload(true);
                })
            });        
        });
});





    $(function(){
      sammyApp.run('/#');
      if(data.users.current()){
        $("#btn-go-to-login").addClass("hidden");
        $("#btn-go-to-register").addClass("hidden");
      }else{
        $("#btn-logout").addClass("hidden");
      }

      $("#btn-logout").on("click",function(){
        data.users.logout()
        .then(function(){
          location='#/';
          document.location.reload(true);
        })
      })
        })

       
        // Initial code

        //http://bookworm-1.apphb.com/api/user/Register
        //http://bookworm-1.apphb.com/api/user/Login
        ////http://bookworm-1.apphb.com/api/user/Logout

        //$(function () {

            //example of get request, no auth
            // httpRequester.getJSON("http://bookworm-1.apphb.com/api/Work/GetAllWorks")
            // .then(function (result) {
            //     console.log(result.data);
            // }, function (e) {
            //     console.log(e);
            // });


            //example of post request, no auth
            //var user =
            //    {
            //        Username: "sashi123",
            //        Password: "gosho",
            //        ConfirmPassword:"gosho"
            //    };
            // httpRequester.postJSON("http://bookworm-1.apphb.com/api/user/Register", user)
            // .then(function (result) {
            //    console.log(result.data);
            // }, function (e) {
            //    console.log(e);
            // });

            //example of post request, with auth

            // var headers = {
            // "X-token": "945aed2f-952a-4bee-9fcf-c1d90805272b" //localStorage.getItem("token")
            // };
           
            // httpRequester.postJSON("http://bookworm-1.apphb.com/api/user/Logout", null, headers)
            // .then(function (result) {
            //     console.log(result.Success);
            // }, function (e) {
            //     console.log(e);
            // });

        //});

    </script>

</body>
</html>
